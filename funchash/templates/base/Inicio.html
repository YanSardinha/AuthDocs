<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Docs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <style>
      body {
          font-family: Arial, sans-serif;
          text-align: center;
          margin: 0;
          background-color: #015e59;
          color: white;
          display: flex;
          justify-content: flex-start;
          align-items: center;
          height: 100vh;
          flex-direction: column;
          padding-top: 20px;
      }

      img.logo {
          width: 300px;
          display: block;
          margin: 20px auto;
      }

      .menu, .key-menu {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 20px;
          margin-top: 20px;
          background-color: rgba(0, 0, 0, 0.7);
          padding: 10px 20px;
          border-radius: 5px;
          width: 570px;
          height: 59px;
      }

      .key-menu {
          margin-top: 40px;
      }

      .menu a, .key-menu a {
          color: white;
          text-decoration: none;
          padding: 10px 15px;
          border-radius: 5px;
          transition: background-color 0.3s;
      }

      .menu a:hover, .menu a.active,
      .key-menu a:hover, .key-menu a.active {
          background-color: rgba(255, 255, 255, 0.2);
      }

      .documents {
          display: flex;
          flex-direction: column;
          margin-top: 50px;
          align-items: center;
          width: 570px;
          max-width: 570px;
      }

      .document {
          display: flex;
          justify-content: space-between;
          align-items: center;
          background-color: rgba(0, 0, 0, 0.7);
          padding: 10px 20px;
          border-radius: 5px;
          margin-bottom: 10px;
          width: 570px;
          height: 59px;
      }

      .verified-icon {
          color: green;
          margin-right: 10px;
          font-size: 20px;
      }

      .pdf-icon {
          color: red;
          margin-left: 10px;
          font-size: 24px;
          transition: color 0.3s;
      }

      .pdf-icon:hover {
          color: darkred;
      }

      footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      text-align: center;
      padding: 10px 0;
      background-color: rgba(0, 0, 0, 0.7);
      }

      .center-content {
          display: flex;
          justify-content: center;
          align-items: center;
          flex-direction: column;
          height: 100vh;
      }


  .signature-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  margin-top: 20px;
}

.signature-field {
  width: 570px;
  height: 80px;
  padding: 10px;
  margin: 0 auto;
  border-radius: 5px;
  border: none;
  text-align: left;
  background-color: rgba(0, 0, 0, 0.7);
  color: white;
  resize: none; /* Desativar o redimensionamento */
  overflow-y: auto; /* Permitir rolagem vertical */
}

.button-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  margin-top: 20px;
}

.signature-button, .save-button {
  width: 570px;
  height: 59px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  margin-top: 10px;
  color: white;
  text-align: center;
  font-weight: bold;
  transition: background-color 0.3s;
}

.signature-button {
  background-color: #46c001;
}

.signature-button:hover {
  background-color: darkgreen;
}

.save-button {
  background-color: #009DCF;
}

.save-button:hover {
  background-color: darkblue;
}
.key-menu-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  margin-top: 20px;
}

.key-field-wrapper {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 100%;
  margin-top: 20px;
}

.key-field {
  width: 570px;
  height: 59px;
  padding: 10px;
  margin: 20px 0;
  border-radius: 5px;
  border: none;
  text-align: center;
  background-color: white; /* Adicione esta linha */
  color: black; /* Adicione esta linha */
}


.generate-button-container {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  margin-top: 20px;
}

.generate-button {
  width: 570px;
  height: 59px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  color: white;
  text-align: center;
  background-color: #F6660D;
  transition: background-color 0.3s;
}

.generate-button:hover {
  background-color: darkorange;
}

.sign-textarea {
  width: 570px;
  height: 59px;
  padding: 10px;
  margin: 20px 0;
  border-radius: 5px;
  border: none;
  text-align: center;
  background-color: white;
  color: black;
  overflow-y: auto;
}


.documents img {
  margin-right: 10px;
}


.logout-section {
  position: absolute;
  top: 10px;
  right: 20px;
}

.logout-icon {
  font-size: 24px;
  color: white;
  cursor: pointer;
  transition: color 0.3s;
}

.logout-icon:hover {
  color: #ddd;
}

/* Estilo para o popup */
.popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  display: none;
}

.popup-content {
  background-color: #015e59;
  padding: 20px;
  border-radius: 5px;
  width: 400px;
  text-align: center;
}

.popup-content button {
  margin-top: 10px;
  padding: 10px;
  border: none;
  cursor: pointer;
  border-radius: 5px;
  background-color: white;
  color: #015e59;
}


.upload-label {
  display: block;
  width: 570px;
  height: 59px;
  padding: 10px;
  margin: 20px 0;
  border-radius: 5px;
  border: 1px solid #ccc;
  background-color: white;
  cursor: pointer;
  text-align: center;
  line-height: 39px;
}

.upload-text {
  display: inline-block;
}

.file-name {
  display: none;
  margin-left: 10px;
  color: #888;
}

.sign-file-input:focus + .upload-label,
.upload-label:hover {
  border-color: #666;
  background-color: #f9f9f9;
}

.upload-label {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 570px;
  height: 59px;
  padding: 10px;
  margin: 20px 0;
  border-radius: 5px;
  border: 1px solid #ccc;
  background-color: white;
  cursor: pointer;
  text-align: center;
  line-height: 39px;
  color: #555;
  font-size: 16px;
}

.upload-icon {
  margin-right: 10px;
  font-size: 20px;
}

.upload-text {
  display: inline-block;
}

.file-name {
  display: none;
  margin-left: 10px;
  color: #888;
}

.sign-file-input:focus + .upload-label,
.upload-label:hover {
  border-color: #666;
  background-color: #f9f9f9;
}


  </style>
</head>

<body class="center-content">

    <img src="https://i.imgur.com/ZvEgmfo.png" alt="AuthDocs Logo" class="logo">
    
    <div class="menu">
        <a href="#" id="inicio" class="active">Início</a>
        <a href="#" id="gerarChaves">Gerar chaves</a>
        <a href="#" id="assinarDocumento">Assinar documento</a>
        <a href="#" id="documentos">Documentos</a>
    </div>

    <div class="content">
        <div class="inicio-content">
            <div class="documents">
              {% if user_documentos %}
              {% for user_documento in user_documentos %}
                <div class="document">
                    <span class="verified-icon">&#x2714;</span>
                    <span>{{user_documento.nome}}</span>
                    <span>{{user_documento.data_anexo|date:"d/m/Y H:i"}}</span>
                    <a href="#" class="pdf-icon" title="Download PDF"><i class="fas fa-file-pdf"></i></a>
                </div>
              {% endfor %}
              {% else %}
            <div class="document">
              <span class="unverified-icon">&#10006;</span>
              <span>Ainda não existe nenhum documento</span>
              <span>Clique aqui para anexar</span>
              <a href="#" class="pdf-icon" title="Download PDF"><i class="fas fa-file-pdf"></i></a>
            </div>
            {% endif %}
            </div>
            
        </div>
        <div class="gerarChaves-content" style="display: none;">
            <div class="key-menu">
                <a href="#" id="publicKeyMenu" class="active">Chave Pública</a>
                <a href="#" id="privateKeyMenu">Chave Privada</a>
            </div>
            <input type="text" id="publicKey" class="key-field" placeholder="Chave Pública" readonly>
            <input type="text" id="privateKey" class="key-field" placeholder="Chave Privada" readonly style="display: none;">
            <div class="generate-button-container">
                <button class="generate-button" onclick="generateKeys()">Gerar chaves</button>
            </div>
        </div>
        <div class="assinarDocumento-content" style="display: none;">
          <form method="post" enctype="multipart/form-data" id="upload">
              {% csrf_token %}
              <div class="signature-wrapper">
                  <label for="document-upload" class="upload-label">
                      
                        <label for="{{ form.document.id_for_label }}">Nome:</label>
                        {{ form.nome }}
                        <div class="form-group">
                        <i class="fas fa-upload upload-icon"></i>
                        <label for="{{ form.arquivo.id_for_label }}">Arquivo:</label>
                        {{ form.arquivo }}
                      </div>
                  </label>
                  <input type="file" name="document" id="document-upload" class="sign-file-input" style="display: none;">
              </div>
              <div class="button-wrapper">
                  <button class="save-button" id="save-button">Salvar</button>
              </div>
          </form>
      </div>
      
      
      <div class="documentos-content" style="display: none;">
        <div class="documents">
            {% for documento in documentos %}
            <div class="document">
                {% if documento.data_assinatura != None %}
                <span class="verified-icon">&#x2714;</span>
                {% else %}
                <img src="https://imgur.com/FVZWbTn.jpg" alt="Saved Document Icon" width="24" style="margin-right: 10px;" class="assinatura-trigger" data-documento-id="{{ documento.id }}">
                {% endif %}
                <span>{{documento.nome}}</span>
                <span>{{documento.data_anexo|date:"d/m/Y H:i"}}</span>
                <a href="#" class="pdf-icon" title="Download PDF"><i class="fas fa-file-pdf"></i></a>
            </div>
            {% endfor %}
        </div>
    </div>
    
        <div class="popup" id="popup" >
          <div class="popup-content">
              <p id="popupMessage">Mensagem aqui</p>
              <button onclick="closePopup()">Fechar</button>
          </div>
        </div>
    </div>

    <footer>
        &copy; Desenvolvido pela equipe AuthDocs
    </footer>

    <script>
      let CurrentUserPublicKey = "{{ chaves_usuario.chave_publica|linebreaksbr }}";
      let CurrentUserprivateKey = "{{ chaves_usuario.chave_privada|linebreaksbr }}";
      let menuItems = document.querySelectorAll('.menu a');
      let contentSections = document.querySelectorAll('.content > div');
      let keyMenus = document.querySelectorAll('.key-menu a');
      let keyFields = document.querySelectorAll('.key-field');
  
      menuItems.forEach(item => {
          item.addEventListener('click', function() {
              menuItems.forEach(i => i.classList.remove('active'));
              contentSections.forEach(section => section.style.display = 'none');
              
              item.classList.add('active');
              let contentId = item.id + '-content';
              document.querySelector('.' + contentId).style.display = 'block';
          });
      });
      
      keyMenus.forEach(menu => {
          menu.addEventListener('click', function() {
              keyMenus.forEach(m => m.classList.remove('active'));
              keyFields.forEach(field => field.style.display = 'none');
      
              menu.classList.add('active');
              let fieldId = menu.id.replace('Menu', '');
              document.getElementById(fieldId).style.display = 'block';
          });
      });
  
      // Seleciona o elemento de entrada de arquivo
      const fileInput = document.getElementById('document-upload');
  
      // Seleciona o elemento de exibição do nome do arquivo
      const fileNameDisplay = document.getElementById('selected-file-name');
  
      // Adiciona um ouvinte de evento 'change' para o elemento de entrada de arquivo
      fileInput.addEventListener('change', function() {
          // Verifica se um arquivo foi selecionado
          if (fileInput.files.length > 0) {
              // Atualiza o texto do elemento de exibição do nome do arquivo
              fileNameDisplay.textContent = fileInput.files[0].name;
          } else {
              // Se nenhum arquivo for selecionado, exibe "Nenhum arquivo selecionado"
              fileNameDisplay.textContent = 'Nenhum arquivo selecionado';
          }
      });
  
      function generateKeys() { 
        document.getElementById('publicKey').value = CurrentUserPublicKey.replace(/<br>/g, '\n');
        document.getElementById('privateKey').value = CurrentUserprivateKey.replace(/<br>/g, '\n');
      }
  
      function showPopup(message) {
        document.getElementById('popupMessage').innerText = message;
        document.getElementById('popup').style.display = 'flex';
      }
  
      function closePopup() {
        document.getElementById('popup').style.display = 'none';
      }
  
      function saveFile() {
          // Verifique se um arquivo foi selecionado
          if (fileInput.files.length === 0) {
              showPopup('Selecione um arquivo antes de salvar.');
              return;
          }
  
          // Crie um objeto FormData para enviar o arquivo
          let formData = new FormData();
          formData.append('document', fileInput.files[0]);
  
          // Faça uma solicitação AJAX para enviar o arquivo
          $.ajax({
              url: '{% url "inicio" %}', // Substitua pelo URL correto de sua view Django
              type: 'POST',
              data: formData,
              processData: false,
              contentType: false,
              success: function(response) {
                  // Lide com a resposta do servidor aqui, se necessário
                  showPopup('Arquivo salvo com sucesso!');
              },
              error: function(xhr, status, error) {
                  // Lide com erros aqui, se necessário
                  showPopup('Erro ao salvar o arquivo: ' + error);
              }
          });
      }


      document.addEventListener("DOMContentLoaded", function() {
    const assinaturaTriggerElements = document.querySelectorAll(".assinatura-trigger");

    assinaturaTriggerElements.forEach(function(element) {
        element.addEventListener("click", function(event) {
            const documentoId = event.target.getAttribute("data-documento-id");
            const form = document.createElement("form");
            form.method = "POST";
            form.action = "{% url 'assinar_documento' %}";  // Substitua pelo URL correto da sua view 'assinar_documento'
            
            const csrfInput = document.createElement("input");
            csrfInput.type = "hidden";
            csrfInput.name = "csrfmiddlewaretoken";
            csrfInput.value = "{{ csrf_token }}";  // Obtenha o token CSRF do template Django

            const documentoIdInput = document.createElement("input");
            documentoIdInput.type = "hidden";
            documentoIdInput.name = "documento_id";
            documentoIdInput.value = documentoId;

            form.appendChild(csrfInput);
            form.appendChild(documentoIdInput);

            document.body.appendChild(form);
            form.submit();
        });
    });
});

  </script>
  

</body>

</html>
